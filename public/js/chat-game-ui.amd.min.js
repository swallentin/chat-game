// chat-game-ui, v0.3.0
// Copyright (c)2012 Stephan Wallentin, EF Labs
// http://github.com/englishtown/chat-game-ui
(function(a,b){typeof define=="function"&&define.amd&&define(["_","jQuery","Backbone, Handlebars, Wami, swfobject"],b)})(this,function(a,b,c,d,e,f){var g=c.Collection.extend({model:j}),h=c.Model.extend({model:j}),i=c.Collection.extend({url:"/todos",model:k,parse:function(a){return a.response.todos},comparator:function(a){return a.get("priority")}}),j=c.Model.extend({}),k=c.Model.extend({defaults:{priority:3},validate:function(a){if(!a.title)return"cannot have an empty title"}}),l=c.Router.extend({vent:a.extend({},c.Events),routes:{"":"index","game/:id":"game"},index:function(){console.log("index")},game:function(a){console.log("game/"+a);var b=new r({el:$("#game"),vent:this.vent});b.render()}}),m=c.View.extend({initialize:function(b){this.vent=b.vent||{},this.clickQuestionEventName=b.clickQuestionEventName||"clickedQuestion",a.bindAll(this)},render:function(){return this.collection.each(this.addQuestion),this},addQuestion:function(a){var b=(new n({model:a,vent:this.vent,clickQuestionEventName:this.clickQuestionEventName})).bind("clickedQuestion",this.onClickQuestion),c=b.render().el;$(this.el).append(c)},onClickQuestion:function(a){this.trigger("clickedQuestion",a)}}),n=c.View.extend({tagName:"button",className:"btn btn-large btn-primary choose-answer",type:"button",events:{click:"onClickedQuestion"},initialize:function(b){this.vent=b.vent||{},a.bindAll(this),this.model.get("difficulty")&&(this.ratingView=new o({level:this.model.get("difficulty"),vent:this.vent}))},render:function(){return $(this.el).html(this.model.get("text")),this.model.get("difficulty")&&$(this.el).append(this.ratingView.render().el),this},onClickedQuestion:function(){var a={view:this,model:this.model};console.log("ChooseQuestionView:onClickedQuestion"),this.trigger("clickedQuestion",a)}}),o=c.View.extend({className:"rating-container",initialize:function(a){this.level=a.level||0},render:function(){var a=0;for(;a<this.level;a++)$(this.el).append('<i class="icon-star icon-yellow"></i>');return this}}),p=c.View.extend({className:"well player",events:{"click .btn-play":"play","click .btn-stop":"stop"},initialize:function(){a.bindAll(this),this.template=d.compile($("#SimpleAudioPlayerView-template").html()),this.on("setupAudio",this.onSetupAudio),this.on("play",this.onPlay),this.on("stop",this.onStop)},render:function(){return this.setupAudio(),this},renderAudioController:function(){console.log("SimpleAudioPlayer:renderAudioController"),$(this.el).html(this.template())},setupAudio:function(){console.log("SimpleAudioPlayer:setupAudio"),this.trigger("setupAudio")},play:function(){console.log("play"),this.trigger("play")},stop:function(){console.log("stop"),this.trigger("stop")},onPlay:function(){console.log("SimpleAudioPlayer:onPlay"),e.startPlaying(this.model.get("url"))},onStop:function(){console.log("SimpleAudioPlayer:onStop"),e.stopPlaying()},onSetupAudio:function(){console.log("SimpleAudioPlayer:onSetupAudio"),$(this.el).html("Setting up audio control.");var a=this.onSetupAudioFinished;e.setup({id:"wami",onLoaded:this.onSetupAudioFinished})},onSetupAudioFinished:function(){console.log("SimpleAudioPlayer:onSetupAudioFinished"),this.renderAudioController()}}),q=c.View.extend({className:"recorder well",events:{"click .btn-record":"record","click .btn-stoprecord":"stop"},initialize:function(){a.bindAll(this),this.template=d.compile($("#SimpleAudioRecorderView-template").html()),this.on("setupAudio",this.onSetupAudio),this.on("record",this.onRecord),this.on("stop",this.onStop)},render:function(){return this.setupAudio(),this},renderAudioController:function(){console.log("SimpleAudioRecorderView:renderAudioController"),$(this.el).html(this.template())},setupAudio:function(){console.log("SimpleAudioRecorderView:setupAudio"),this.trigger("setupAudio")},record:function(){console.log("SimpleAudioRecorderView:record"),this.trigger("record")},stop:function(){console.log("stop"),this.trigger("stop")},onRecord:function(){console.log("SimpleAudioRecorderView:onPlay"),e.startRecording(this.model.get("recordingUrl"))},onStop:function(){console.log("SimpleAudioRecorderView:onStop"),e.stopRecording()},onSetupAudio:function(){console.log("SimpleAudioRecorderView:onSetupAudio"),$(this.el).html("Setting up audio control.");var a=this.onSetupAudioFinished;e.setup({id:"wami",onLoaded:this.onSetupAudioFinished})},onSetupAudioFinished:function(){console.log("SimpleAudioRecorderView:onSetupAudioFinished"),this.renderAudioController()}}),r=c.View.extend({initialize:function(a){this.vent=a.vent||{},this.playingView=new y({vent:this.vent})},render:function(){return $(this.el).html(this.playingView.render().el),this}}),s=c.View.extend({className:"item game-list-item",tagName:"LI",initialize:function(){this.template=d.compile($("#GameListItemView-template").html())},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this}}),t=c.View.extend({className:"game-list",tagName:"UL",initialize:function(b){this.vent=b.vent||{},a.bindAll(this)},render:function(){return this.collection.each(this.addItem),this},addItem:function(a){var b=new s({model:a}),c=b.render().el;$(this.el).append(c)}}),u=c.View.extend({initialize:function(a){this.vent=a.vent||{}}}),v=c.View.extend({initialize:function(a){this.vent=a.vent||{}}}),w=c.View.extend({tagName:"div",className:"action quotes",initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),a.bindAll(this),this.on("load",this.onLoad),this.vent.on("/game/#:id/listening",this.renderListening),this.vent.on("/game/#:id/speaking",this.renderSpeaking);var e=new c.Model({id:0,text:"Lorem ipsum dolor sit amet.",difficulty:1}),f=new c.Model({id:1,text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit.",difficulty:2}),g=new c.Model({id:2,text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur sed purus nulla.",difficulty:3}),h=new c.Collection([e,f,g]);this.game=new c.Model({questions:h})},onLoad:function(){},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},renderActiveView:function(){$(this.el).find("#content").html(this.activeView.render().el)},renderListening:function(){console.log("GameActionView:renderListening"),this.activeView=(new C({vent:this.vent,model:this.game})).bind("next",this.onFinishedListening),this.renderActiveView()},renderSpeaking:function(){console.log("GameActionView:renderSpeaking"),this.activeView=(new G({vent:this.vent,model:this.game})).bind("next",this.onFinishedSpeaking),this.renderActiveView()},onFinishedListening:function(){this.vent.trigger("/game/#:id/speaking")},onFinishedSpeaking:function(){this.vent.trigger("/game/#:id/listening")}}),x=c.View.extend({className:"game-over",initialize:function(a){this.vent=a.vent||{}}}),y=c.View.extend({className:"playing",tagName:"div",initialize:function(a){this.vent=a.vent||{};var b=new c.Model({name:"My Name",imgUrl:"/img/profiles/c.jpg"}),d=new c.Model({topic:{imgUrl:"/img/profiles/a.jpg",description:"A topic"},playerA:{profileImgUrl:"/img/profiles/b.jpg"},playerB:{profileImgUrl:"/img/profiles/c.jpg"},score:21});this.statusView=new z({vent:this.vent,model:d,template:$("#GameStatusView-template").html()}),this.actionView=new w({vent:this.vent,template:$("#GameActionView-template").html(),model:b})},render:function(){return $(this.el).append(this.statusView.render().el),$(this.el).append(this.actionView.render().el),this.vent.trigger("/game/#:id/speaking"),this}}),z=c.View.extend({className:"game-state-info btn-inverse",initialize:function(a){this.template=d.compile(a.template||"")},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this}}),A=c.View.extend({events:{"click .btn-next":"onClickedNext"},initialize:function(b){this.message=b.message||"No message provided.",this.template=d.compile($("#AnswerView-template").html()),this.vent=b.vent||{},a.bindAll(this)},render:function(){return $(this.el).html(this.template({message:this.message})),this},onClickedNext:function(){this.trigger("next")}}),B=c.View.extend({initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),a.bindAll(this),this.on("clickedCorrectAnswer",this.onCorrectAnswer),this.on("clickedWrongAnswer",this.onWrongAnswer),this.on("render",this.onRender),this.correctAnswerId=1,this.questionList=(new m({collection:this.model.get("questions"),vent:this.vent})).bind("clickedQuestion",this.onClickedQuestion),this.audioPlayer=new p({model:new c.Model({url:"http://dev.local:3000/game/recording/1337"})})},render:function(){return console.log("ChooseRightAnswerView:render"),$(this.el).html(this.template({message:"What is Samsan saying?"})),$(this.el).append(this.audioPlayer.render().el),$(this.el).append(this.questionList.render().el),this.trigger("render"),this},renderResponseView:function(){this.answerView.bind("next",this.onNext),$(this.el).append(this.answerView.render().el)},isCorrectAnswer:function(a){return this.correctAnswerId==a.id},onClickedQuestion:function(a){console.log("ChooseRightAnswerView:onClickedQuestion"),this.questionList.off("clickedQuestion",this.onClickedQuestion);var b=this.isCorrectAnswer(a.model),c=b?"btn-success btn-iscorrect":"btn-danger btn-iswrong";$(a.view.el).removeClass("btn-primary"),$(a.view.el).addClass(c),$(a.view.el).addClass("active");var d=b?"clickedCorrectAnswer":"clickedWrongAnswer";this.trigger(d)},onCorrectAnswer:function(){this.answerView=new A({vent:this.vent,message:"Correct!"}),this.renderResponseView()},onWrongAnswer:function(){this.answerView=new A({vent:this.vent,message:"Wrong!"}),this.renderResponseView()},onNext:function(){this.trigger("next")}}),C=c.View.extend({className:"listening",initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),a.bindAll(this),this.activeView=(new B({el:$(this.el),vent:this.vent,template:$("#ChooseRightAnswerView-template").html(),model:this.model})).bind("next",this.onNext)},render:function(){return this.activeView.render(),this},onNext:function(){this.trigger("next")}}),D=c.View.extend({className:"next-turn",initialize:function(a){this.vent=a.vent,this.template=d.compile(a.template||"")},render:function(){return $(this.el).html(this.template({message:"It's your turn now."})),this}}),E=c.View.extend({tagName:"div",initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),a.bindAll(this),this.clickedQuestionEventName=b.clickedQuestionEventName||"/game/speaking/clickedAnswer",this.questionList=(new m({collection:this.model.get("questions"),vent:this.vent,clickedQuestionEventName:this.clickedQuestionEventName})).bind("clickedQuestion",this.onClickedQuestion)},render:function(){return $(this.el).append(this.template({message:"Choose what to say!"})),$(this.el).append(this.questionList.render().el),this},onClickedQuestion:function(a){console.log("PlayingChooseWhatToSay:onClickedQuestion"),this.trigger("clickedQuestion",a)}}),F=c.View.extend({className:"next-turn",initialize:function(a){this.vent=a.vent,this.template=d.compile(a.template||"")},render:function(){$(this.el).html(this.template({message:"Waiting for other party to reply"}));var a=this;return setTimeout(function(){a.trigger("next")},2e3),this}}),G=c.View.extend({initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),a.bindAll(this),this.views=[],this.on("onload",this.onLoad),this.trigger("onload")},render:function(){return $(this.el).html(this.activeView.render().el),this},onLoad:function(){var a=(new E({vent:this.vent,template:$("#PlayingChooseWhatToSay-template").html(),model:this.model})).bind("clickedQuestion",this.onClickedQuestion);this.activeView=a},onClickedQuestion:function(a){console.log("PlayingSpeakingView:onClickedQuestion");var b=(new H({vent:this.vent,template:$("#RecordTranslation-template").html(),model:a.model})).bind("successfull",this.onRecordingSent);this.activeView=b,this.render()},onRecordingSent:function(){var a=(new F({vent:this.vent,template:$("#PlayingNextTurnView-template").html()})).bind("next",this.onNextTurnFinished);this.activeView=a,this.render()},onNextTurnFinished:function(){this.trigger("next")}}),H=c.View.extend({className:"record",initialize:function(b){this.vent=b.vent||{},this.template=d.compile(b.template||""),this.questionView=new n({model:this.model,vent:b.vent}),a.bindAll(this),this.on("/game/#id/recording_succesful",this.success),this.on("/game/#id/recording_failed",this.failed),this.recorder=new q({model:new c.Model({recordingUrl:"http://dev.local:3000/game/recording/1337",playingUrl:"http://dev.local:3000/game/recording/1337"})})},events:{"click .btn.btn-record":"record","click .btn.btn-send-recording":"next"},render:function(){return $(this.el).append(this.questionView.render().el),$(this.el).append(this.template({instruction:"Translate to English, and record your translation!"})),$(this.el).append(this.recorder.render().el),this},record:function(){console.log("doing record");var a=this;setTimeout(function(){a.trigger("/game/#id/recording_succesful")},500)},hide:function(){$(this.el).find(".alert.alert-error").hide(),$(this.el).find(".btn.btn-send-recording").hide()},success:function(){$(this.el).find(".alert.alert-error").hide(),$(this.el).find(".btn.btn-send-recording").show()},failed:function(){$(this.el).find(".alert.alert-error").show(),$(this.el).find(".btn.btn-send-recording").hide()},next:function(){this.trigger("successfull")}}),I=c.View.extend({tagName:"UL",className:"todos",initialize:function(){a.bindAll(this,"addTodo")},render:function(){this.collection.each(this.addTodo)},addTodo:function(a){var b=new J({model:a}),c=b.render().el;$(this.el).append(c)}}),J=c.View.extend({tagName:"li",initialize:function(b){a.bindAll(this,"edit"),this.template=d.compile(b.template||"")},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},events:{"click a.edit":"edit"},edit:function(){this.$("h2").fadeOut(),this.$("input.edit").fadeIn()}}),K=function(){var a=function(){var a=new l;c.history.start()};return{initialize:a}};return $(document).ready(function(){K().initialize(),console.log("testing")}),ChatGameUI});